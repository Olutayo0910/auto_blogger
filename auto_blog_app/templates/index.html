<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Blog Generator</title>
    <!-- Link to Tailwind CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Link to Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/1d95d16c4b.js" crossorigin="anonymous"></script>
    <style>
        /* Define keyframes for the rotation animation */
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Apply animation to the loading circle */
        #loading-circle {
            width: 50px; /* Adjust size as needed */
            height: 50px; /* Adjust size as needed */
            border: 4px solid #ccc; /* Border style */
            border-top-color: green; /* Border color for the rotating circle */
            border-radius: 50%; /* Make it a circle */
            animation: rotate 1s linear infinite; /* Apply rotation animation */
        }
        
        /* Style for text */
        span {
            font-size: 12px;
        }

        /* Custom class to increase height of text */
        .text-tall {
            transform: scaleY(1.2); /* Adjust this value to change the height */
            display: inline-block; /* Ensure the transform doesn't affect surrounding elements */
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-green-100 font-sans antialiased">
    <!-- Navigation bar -->
    <nav class="bg-gray-100 p-4 text-black flex justify-between border-b border-green-500">
        <div>
            <!-- Links to external sites -->
            <a href="https://www.youtube.com/" class="mr-2 text-black hover:underline"><i class="fa-brands fa-youtube text-red-500"></i> YouTube</a>
            <a href="https://www.gmail.com/" class="text-black hover:underline"><i class="fa-solid fa-m"></i> Gmail</a>
        </div>
        
        <!-- User welcome message and logout link -->
        <div>
            <a href="#" class="text-black hover:underline mx-4">Hi {{ user.username }}</a>
            <a href="/blog-list" class="text-black hover:underline mx-4">Saved Blog Posts</a>
            <a href="/logout" class="text-black hover:underline">Logout</a>
        </div>
    </nav>
    
    <!-- Main content area -->
    <div class="flex-grow flex items-center justify-center mt-16 mb-16">
        <div class="bg-white max-w-3xl mx-auto p-6 rounded-lg shadow-md transition-transform transform hover:scale-105 flex flex-col w-full">
            <!-- YouTube video section -->
            <div id="youtubeVideo" class="mt-10" style="display: none;">
                <!-- YouTube Embedded Player -->
                <iframe id="youtubePlayer" width="100%" height="315" src="" frameborder="0" allowfullscreen></iframe>
            </div>
            
            <!-- Link input section -->
            <div class="text-center font-semibold mt-6 text-2xl">
                <!-- Logo -->
                <h1 class="text-3xl text-center text-green-500 font-bold text-tall">Bloogle</h1>
                <div class="flex flex-col md:flex-row mt-4">
                    <input id="youtubelink" type="url" placeholder="Paste Your YouTube link" class="flex-grow p-2 border border-green-500 rounded-l-md mb-2 md:mb-0">
                    <button id="generateBlogButton" class="bg-green-500 hover:bg-green-400 text-white rounded-r-md px-4 py-2 transition-colors">Generate Blog</button>
                </div>
            </div>
            
            <!-- Loading spinner -->
            <div id="loading-spinner" style="display: none;" class="relative flex justify-center items-center load mx-auto mt-8">
                <div class="absolute animate-spin rounded-full h-24 w-24 border-t-2 border-b-2 border-green-500"></div>
                <img src="https://www.svgrepo.com/show/509001/avatar-thinking-9.svg" class="rounded-full h-20 w-20">
            </div>

            <!-- Generated blog article section -->
            <section class="mt-10 flex-grow">
                <h2 class="text-xl mb-4 text-center font-semibold">Generated Article</h2>
                <div id="blogContentWrapper" class="mt-2 text-gray-700 space-y-2" style="display: none;">
                    <!-- Copy box -->
                    <div class="bg-gray-200 p-4 rounded-md">
                        <textarea id="blogContent" class="w-full p-2 bg-gray-200 border-none rounded-md" rows="10" readonly></textarea>
                        <button id="copyButton" class="mt-2 bg-green-500 hover:bg-green-400 text-white py-2 px-4 rounded-md">Copy</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-black mt-6">
        Powered by Olutayo Ogunlade
    </footer>

    <!-- JavaScript to handle blog generation and copy functionality -->
    <script>
        document.getElementById('youtubelink').addEventListener('input', () => {
            const youtubeLink = document.getElementById('youtubelink').value;
            const youtubePlayer = document.getElementById('youtubePlayer');
            const youtubeVideo = document.getElementById('youtubeVideo');

            if (youtubeLink) {
                const videoId = getYoutubeVideoId(youtubeLink);
                if (videoId) {
                    youtubePlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                    youtubeVideo.style.display = 'block';
                } else {
                    youtubePlayer.src = '';
                    youtubeVideo.style.display = 'none';
                }
            } else {
                youtubePlayer.src = '';
                youtubeVideo.style.display = 'none';
            }
        });

        function getYoutubeVideoId(link) {
            // Regular expression to match YouTube video ID in various formats
            const regex = /^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = link.match(regex);
            return match ? match[1] : null;
        }

        document.getElementById('generateBlogButton').addEventListener('click', async () => {
            const youtubeLink = document.getElementById('youtubelink').value;
            const blogContent = document.getElementById('blogContent');
            const blogContentWrapper = document.getElementById('blogContentWrapper');

            if (youtubeLink) {
                // Show loading spinner
                document.getElementById('loading-spinner').style.display = 'block';
                blogContent.value = ''; // Clear previous content
                blogContentWrapper.style.display = 'none'; // Hide the blog content wrapper initially

                const endpointUrl = '/generate-blog/';
                try {
                    const response = await fetch(endpointUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ link: youtubeLink })
                    });

                    const data = await response.json();
                    blogContent.value = data.content;

                    // Display the blog content wrapper if there is content
                    if (data.content) {
                        blogContentWrapper.style.display = 'block';
                    }
                } catch (error) {
                    console.error("Error occurred:", error);
                    alert("Something went wrong. Please try again later.");
                }
                // Hide loading spinner
                document.getElementById('loading-spinner').style.display = 'none';
            } else {
                alert("Please enter a YouTube link.");
            }
        });

        document.getElementById('copyButton').addEventListener('click', () => {
            const blogContent = document.getElementById('blogContent');
            blogContent.select();
            blogContent.setSelectionRange(0, 99999); // For mobile devices
            document.execCommand('copy');
            alert('Content copied to clipboard');
        });
    </script>
</body>
</html>
